"use strict";var __importDefault=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SignApp=void 0;const ohos_app_task_js_1=require("./task/ohos-app-task.js"),sign_util_js_1=require("./sign/sign-util.js"),path_1=__importDefault(require("path")),package_app_js_1=require("./package-app.js"),task_names_js_1=require("./common/task-names.js"),sign_type_enum_js_1=require("../enum/sign-type-enum.js"),sign_model_js_1=require("./sign/command-builder-impl/sign-model.js"),ohos_logger_js_1=require("../utils/log/ohos-logger.js");class SignApp extends ohos_app_task_js_1.OhosAppTask{constructor(i,e){super(i,e,task_names_js_1.TaskNames.CommonTask.SIGN_APP),this.log=ohos_logger_js_1.OhosLogger.getLogger(SignApp.name),this.pathInfo=this.service.getPathInfo(),this.outputFileName=this.service.getAppOutputFileName(),this.inputFile=path_1.default.resolve(this.pathInfo.getProjectOutputPath(),this.outputFileName),this.outputFile=path_1.default.resolve(this.pathInfo.getProjectOutputPath(),this.service.getAppOutputFileName(!0)),this.signUtil=new sign_util_js_1.SignUtil(e,sign_type_enum_js_1.SignTypeEnum.APP,this.pathInfo,this.service.getTargetProduct()),this.signingConfig=this.signUtil._signingConfig}beforeAlwaysAction(){this.log.warn(this.signUtil._signingConfigCheckLogStr)}declareInputs(){var i;const e=super.declareInputs();return e.set("signingConfig",JSON.stringify(null===(i=this.signingConfig)||void 0===i?void 0:i.material)).set("sdkToolchainsComponentVersion",this.service.getSdkInfo().getToolchainsComponentVersion()),e}declareInputFiles(){var i,e,t,s,n,o;const r=super.declareInputFiles();return r.addEntry(this.inputFile,{isDirectory:!1}),(null===(e=null===(i=this.signingConfig)||void 0===i?void 0:i.material)||void 0===e?void 0:e.certpath)&&r.addEntry(this.signingConfig.material.certpath,{isDirectory:!1}),(null===(s=null===(t=this.signingConfig)||void 0===t?void 0:t.material)||void 0===s?void 0:s.profile)&&r.addEntry(this.signingConfig.material.profile,{isDirectory:!1}),(null===(o=null===(n=this.signingConfig)||void 0===n?void 0:n.material)||void 0===o?void 0:o.storeFile)&&r.addEntry(this.signingConfig.material.storeFile,{isDirectory:!1}),r}declareOutputFiles(){return this.outputFile?super.declareOutputFiles().addEntry(this.outputFile,{isDirectory:!1}):super.declareOutputFiles()}doTaskAction(){this.signUtil.sign(new sign_model_js_1.SignModel(sign_type_enum_js_1.SignTypeEnum.APP,this.inputFile,this.outputFile))}initTaskDepends(){this.project.registryDependsOnTask(this,new package_app_js_1.PackageApp(this.project,this.service))}}exports.SignApp=SignApp;